#!/bin/bash

DATA_DIR=$1
IN_FILE=$2
MODEL_DIR=$3
OUT_FILE=$4

mkdir -p $OUTDIR

# Preprocess test set
echo "Preprocessing testset..."
spm_encode --model=$DATA_DIR/spm.model < $IN_FILE > $IN_FILE.bpe

# Decode test set
sockeye-translate --models=$MODEL_DIR \
                  --input $IN_FILE.bpe \
                  --output $OUT_FILE.bpe \
                  --batch-size 32 \
                  --max-output-length 144

# Postprocess test set
echo "Postprocessing testset..."
spm_decode --model=$DATA_DIR/spm.model < $OUT_FILE.bpe > $OUT_FILE

echo "Done translations for $IN_FILE and saved in $OUT_FILE."
